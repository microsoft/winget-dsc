# winget-dsc pipeline to publish artifacts
name: '$(Build.DefinitionName)-$(Build.DefinitionVersion)-$(Date:yyyyMMdd)-$(Rev:r)'

# Commit triggers
trigger:
- main

# PR triggers
pr:
  branches:
    include:
    - main
  paths:
    include:
    - pipelines/azure-pipelines.yml
    - resources/*
    - tests/*
  
resources:
  repositories:
  - repository: self
    type: git
    ref: refs/heads/main
  - repository: 1ESPipelineTemplates
    type: git
    name: 1ESPipelineTemplates/1ESPipelineTemplates
    ref: refs/tags/release
extends:
  template: v1/1ES.Official.PipelineTemplate.yml@1ESPipelineTemplates
  parameters:
    pool:
      name: Azure-Pipelines-1ESPT-ExDShared
      image: windows-2022
      os: windows
    customBuildTags:
    - ES365AIMigrationTooling

    stages:
    - stage: WinGet_DSC_Artifacts_Publish

      jobs:
      - job: Publish_WinGet_DSC_Resources
        displayName: "Publish WinGet DSC Resources"
        steps:
        - checkout: self
          clean: true
          fetchTags: false        
        - task: 1ES.PublishPipelineArtifact@1
          displayName: Publish Microsoft.Windows.Developer Module
          targetPath: $(Build.SourcesDirectory)\resources\Microsoft.Windows.Developer\
          artifactName: Microsoft.Windows.Developer
        - task: 1ES.PublishPipelineArtifact@1
          displayName: Publish Microsoft.Windows.Setting.Accessibility Module
          targetPath: $(Build.SourcesDirectory)\resources\Microsoft.Windows.Setting.Accessibility\
          artifactName: Microsoft.Windows.Setting.Accessibility
        - task: 1ES.PublishPipelineArtifact@1
          displayName: Publish PythonPip3Dsc Module
          targetPath: $(Build.SourcesDirectory)\resources\PythonPip3Dsc\
          artifactName: PythonPip3Dsc
        - task: 1ES.PublishPipelineArtifact@1
          displayName: Publish YarnDsc Module
          targetPath: $(Build.SourcesDirectory)\resources\YarnDsc\
          artifactName: YarnDsc
        - task: 1ES.PublishPipelineArtifact@1
          displayName: Publish NpmDsc Module
          targetPath: $(Build.SourcesDirectory)\resources\NpmDsc\
          artifactName: NpmDsc
        - task: 1ES.PublishPipelineArtifact@1
          displayName: Publish Microsoft.WindowsSandbox.DSC Module
          targetPath: $(Build.SourcesDirectory)\resources\Microsoft.WindowsSandbox.DSC\
          artifactName: Microsoft.WindowsSandbox.DSC
        - task: 1ES.PublishPipelineArtifact@1
          displayName: Publish GitDsc Module
          targetPath: $(Build.SourcesDirectory)\resources\GitDsc\
          artifactName: GitDsc